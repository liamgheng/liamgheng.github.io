---
layout: post
title: "软件架构笔记 02"
---

软件架构笔记第二篇，主要讲架构设计的各个阶段。

## 需求分析

架构设计中，需求分析应该占 1/3 精力。

核心要搞清楚：
- 面向的核心用户人群是谁？
- 原始需求是什么？核心问题有哪几个？
- 产品创造的价值点是什么，用户关注的核心指标是什么？
- 用户需求潜在的变化在哪些地方？区分出变化点和稳定点。

为何架构师需要自己去了解，而非全盘接受产品经理传递过来的信息：
- 用户需求理解很难传达，需求文档是产品经理和客户沟通之后的二次加工
- 产品设计过程需要架构师深度参与，因为产品经理本身是连接用户和技术的桥梁，架构师作为技术这一端，如果只是被动响应是不行的，需要跨一步更主动一些。或者说产品经理缺少技术广度深度，需要架构师去补位。

如何做好需求分析
- 心态第一，装得住客户需求，尊重需求反馈。
- 对问题抛根问底。
- 对需求归纳整理，区分变化和不变。

需求分析产出：
- 用户故事。
- 非功能指标，比如升级兼容性，是否易运维等等。

> 千万不可在这一步节省时间，应该广泛收集意见和讨论，这一步打好基础会给以后带来几十倍回报。
> 举例来说，我经历过某 WAF 系统强依赖的 PostgreSQL 并且未考虑多租户设计，导致后期从硬件转为上云时花费了大量时间适配 MySQL 和多租户设计，其实如果架构师视野足够广阔，这些是很容易在架构阶段就避免的。

## 概要设计

搭建大框架，明确每个子系统的职责边界和接口协议，本质是分解领域问题。

如果子系统不分解不会有风险，则可以不在这个阶段分解。

使用用户故事把各个模块串联起来，说明各个模块如何配合来完成整个流程。

## 详细设计

详细设计指的是对每个模块细致的设计，目标是研发可以根据文档描述的模块细节较容易实现该模块，从而多个模块可以分成多个研发并行研发，提高速度。

详细设计容易犯的错误：
1. 是太过细致，导致看文档的人抓不住重点，或者是太简略无法指导下一步写代码。
2. 只给出结论未说明原因，比如某个 Go Channel Size 用 1024，这个数据是怎么算出来的，应该列一下背后逻辑。

## 迭代规划

方向对不代表能走到最后，所以执行路径（优先级）很重要。

架构师一定要搞清楚不同阶段侧重点不同，在大多数产品迭代中，应该先快一些开发出一个基本够用的产品并且发出内测获得一些反馈，然后根据反馈有选择迭代，然后增强一些非功能需求并且发出正式版本。

有两个好处：
1. 较早发出内测版本可以获得高层关注，缓解他们的焦虑，确保项目资源投入不会减少。在公司中真的遇到不少项目不错，但是由于完美主义迟迟不发出版本导致高层决定减少投入最后黄了的情况。
2. 收获反馈确保不走偏，并且也更清楚下一步迭代重点，确保始终在做最高优的事情。
3. 发出可用产品可以提升团队士气。
